@startuml
skinparam componentStyle rectangle
skinparam shadowing false
skinparam wrapWidth 220
skinparam defaultTextAlignment center

title FastFoodOnline - Consolidated Component Diagram

package "Website (Client Layer)" {
  component "Customer Web App\n(frontend/src, React SPA)" as CustomerApp
  component "Admin Web App\n(admin/src, React SPA)" as AdminApp
}

interface "REST API\nHTTPS :4000/api/v2/**" as RestPort
interface "OpenAPI Docs\nHTTPS :4000/api-docs" as DocsPort

' Clients require interfaces (socket)
CustomerApp .. RestPort
AdminApp .. RestPort
AdminApp .. DocsPort

package "Backend Layer" {
  package "Presentation / API Layer" {
    component "Express Router Layer\nbackend/routes/*.js" as Router
    component "JWT Auth Middleware\nmiddleware/auth.js" as Auth
    component "Controllers v2\n(menu, orders, inventory,\nbranch, staff, notification, etc.)" as ControllersV2
    component "Swagger/OpenAPI Publisher\nswagger-jsdoc + swagger-ui" as Swagger
  }

  ' Router provides REST API
  Router - RestPort
  ' Request flow: Router -> Auth -> Controllers
  Router --> Auth
  Auth --> ControllersV2

  package "Business / Domain Services" {
    component "Menu & Catalog Service\n(services/v2/menuService.js,\ncategoryService.js)" as MenuSvc
    component "Ordering & Payment Service\n(services/v2/orderService.js)" as OrderSvc
    component "Inventory & Branch Ops Service\n(services/v2/inventoryService.js,\nbranchService.js,\nrestaurantService.js)" as InventorySvc
    component "People & Access Service\n(services/userService.js,\nv2/staffService.js,\nadminAccountService.js,\ncustomerService.js)" as PeopleSvc
    component "Notification Service\n(services/v2/notificationService.js)" as NotificationSvc
  }

  ControllersV2 --> MenuSvc
  ControllersV2 --> OrderSvc
  ControllersV2 --> InventorySvc
  ControllersV2 --> PeopleSvc
  ControllersV2 --> NotificationSvc

  package "Data Access Layer" {
    component "Repositories\n(repositories/**/*.js)" as Repos
    component "Mongoose Models\n(models/**/*.js)" as Models
  }

  MenuSvc --> Repos
  OrderSvc --> Repos
  InventorySvc --> Repos
  PeopleSvc --> Repos
  NotificationSvc --> Repos

  Repos --> Models

  ' Swagger provides docs
  Swagger - DocsPort

component "Payment Provider Integrations\nStripe Checkout, MoMo, VNPAY" as PaymentAdapters
OrderSvc --> PaymentAdapters
}

package "Third-Party Components" {
  component "Stripe Checkout" as Stripe
  component "MoMo Gateway" as Momo
  component "VNPAY" as Vnpay
  component "Cloudinary\n(CDN + Media Storage)" as Cloudinary
}

PaymentAdapters --> Stripe
PaymentAdapters --> Momo
PaymentAdapters --> Vnpay
CustomerApp .. Cloudinary
AdminApp .. Cloudinary

package "Database" {
  database "MongoDB Atlas\n(cloud-managed)" as Mongo
}

Models --> Mongo

note right of RestPort
  JSON/REST API consumed by both SPAs.
  All requests include token header when authenticated.
end note

note bottom of PaymentAdapters
  Each adapter encapsulates provider-specific
  signing logic and callback verification.
end note

@enduml
